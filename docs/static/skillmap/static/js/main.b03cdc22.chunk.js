(this.webpackJsonpskillsmap=this.webpackJsonpskillsmap||[]).push([[0],{32:function(e,t,r){},33:function(e,t,r){},34:function(e,t,r){},36:function(e,t,r){},37:function(e,t,r){},38:function(e,t,r){},39:function(e,t,r){"use strict";r.r(t);var a=r(0),n=r(1),i=r.n(n),c=r(12),s=r.n(c),o=r(7),l=r(13),d=r(10),u=r(2),p="ADD_SKILL_MAP",v="CLEAR_SKILL_MAPS",h="CHANGE_SELECTED_ITEM",m="SET_HEADERID_FOR_ACTIVITY",b="OPEN_ACTIVITY",j="CLOSE_ACTIVITY",f="SET_PAGE_TITLE",O="SET_PAGE_DESCRIPTION",y="SET_PAGE_INFO_URL",k="SHOW_COMPLETION_MODAL",g="HIDE_COMPLETION_MODAL",x=r(8);function I(e,t,r){var a;return!!(null===(a=w(e,t,r))||void 0===a?void 0:a.isCompleted)}function w(e,t,r){var a;return null===(a=e.mapProgress[t])||void 0===a?void 0:a.activityState[r]}var C={title:"Game Maker Guide",description:"Level up your game making skills by completing the tutorials in this guide.",user:{mapProgress:{},completedTags:{}},maps:{}};function N(e,t,r,a){var n,i=w(e,t,r);return i||(i={isCompleted:!1,activityId:r,headerId:a}),Object(u.a)(Object(u.a)({},e),{},{mapProgress:Object(u.a)(Object(u.a)({},e.mapProgress),{},Object(d.a)({},t,Object(u.a)(Object(u.a)({},e.mapProgress[t]||{mapId:t}),{},{activityState:Object(u.a)(Object(u.a)({},(null===(n=e.mapProgress[t])||void 0===n?void 0:n.activityState)||{}),{},Object(d.a)({},r,Object(u.a)(Object(u.a)({},i),{},{headerId:a})))})))})}var A=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case p:return Object(u.a)(Object(u.a)({},t),{},{user:Object(u.a)(Object(u.a)({},t.user),{},{mapProgress:Object(u.a)(Object(u.a)({},t.user.mapProgress),{},Object(d.a)({},r.map.mapId,{mapId:r.map.mapId,activityState:{}}))}),maps:Object(u.a)(Object(u.a)({},t.maps),{},Object(d.a)({},r.map.mapId,r.map))});case v:return Object(u.a)(Object(u.a)({},t),{},{maps:{}});case h:return Object(u.a)(Object(u.a)({},t),{},{selectedItem:r.id});case b:return Object(u.a)(Object(u.a)({},t),{},{editorView:{currentMapId:r.mapId,currentActivityId:r.activityId,currentHeaderId:null===(e=w(t.user,r.mapId,r.activityId))||void 0===e?void 0:e.headerId}});case j:return Object(u.a)(Object(u.a)({},t),{},{editorView:void 0});case m:return Object(u.a)(Object(u.a)({},t),{},{editorView:Object(u.a)(Object(u.a)({},t.editorView),{},{currentHeaderId:r.id}),user:N(t.user,t.editorView.currentMapId,t.editorView.currentActivityId,r.id)});case f:return Object(u.a)(Object(u.a)({},t),{},{title:r.title});case O:return Object(u.a)(Object(u.a)({},t),{},{description:r.description});case y:return Object(u.a)(Object(u.a)({},t),{},{infoUrl:r.infoUrl});case k:return Object(u.a)(Object(u.a)({},t),{},{modal:{currentMapId:r.mapId,currentActivityId:r.activityId}});case g:return Object(u.a)(Object(u.a)({},t),{},{modal:void 0});default:return t}},S=Object(l.b)(A),E=r(3),T=r(4),P=r(6),M=r(5),L=function(e,t){return{type:b,mapId:e,activityId:t}},D=function(e){Object(P.a)(r,e);var t=Object(M.a)(r);function r(){var e;Object(E.a)(this,r);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).onBackClicked=function(){e.props.dispatchCloseActivity()},e}return Object(T.a)(r,[{key:"render",value:function(){var e=this.props.activityOpen;return Object(a.jsxs)("div",{className:"header",children:[Object(a.jsxs)("div",{className:"header-left",children:[Object(a.jsx)("i",{className:"icon game"}),e&&Object(a.jsx)("i",{className:"icon arrow left",role:"button",onClick:this.onBackClicked})]}),Object(a.jsx)("div",{className:"spacer"}),Object(a.jsxs)("div",{className:"header-right",children:[Object(a.jsx)("i",{className:"icon square"}),"MICROSOFT"]})]})}}]),r}(n.Component);var H={dispatchCloseActivity:function(){return{type:j}}},R=Object(o.b)((function(e,t){return e?{activityOpen:!!e.editorView}:{}}),H)(D),_=function(e){Object(P.a)(r,e);var t=Object(M.a)(r);function r(){return Object(E.a)(this,r),t.apply(this,arguments)}return Object(T.a)(r,[{key:"render",value:function(){var e=this.props,t=e.title,r=e.description,n=e.icon;return Object(a.jsx)("div",{className:"banner",children:Object(a.jsxs)("div",{className:"banner-card",children:[Object(a.jsx)("i",{className:"icon ".concat(n)}),Object(a.jsxs)("div",{className:"banner-text",children:[Object(a.jsx)("div",{className:"banner-title",children:t}),Object(a.jsx)("div",{className:"banner-description",children:r})]})]})})}}]),r}(n.Component);var W=Object(o.b)((function(e,t){return{title:e.title,description:e.description}}))(_),B=(r(32),function(e){Object(P.a)(r,e);var t=Object(M.a)(r);function r(){var e;Object(E.a)(this,r);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).handleModalClick=function(e){e.stopPropagation(),e.preventDefault()},e.handleCloseClick=function(){e.props.onClose&&e.props.onClose(),e.setState({visible:!1})},e}return Object(T.a)(r,[{key:"render",value:function(){var e=this.props,t=e.title,r=e.actions;return Object(a.jsx)("div",{className:"modal-overlay",onClick:this.handleCloseClick,children:Object(a.jsxs)("div",{className:"modal",onClick:this.handleModalClick,children:[Object(a.jsxs)("div",{className:"modal-header",children:[Object(a.jsx)("div",{className:"modal-title",children:t}),Object(a.jsx)("div",{className:"spacer"}),Object(a.jsx)("div",{className:"modal-close-icon",onClick:this.handleCloseClick,children:Object(a.jsx)("i",{className:"icon close"})})]}),Object(a.jsx)("div",{className:"modal-body",children:this.props.children}),r&&r.length>0&&Object(a.jsx)("div",{className:"modal-actions",children:r.map((function(e,t){return Object(a.jsx)("div",{className:"modal-button ".concat(e.className),onClick:e.onClick,children:e.label},t)}))})]})})}}]),r}(n.Component)),U=function(e){Object(P.a)(r,e);var t=Object(M.a)(r);function r(){return Object(E.a)(this,r),t.apply(this,arguments)}return Object(T.a)(r,[{key:"render",value:function(){var e=this.props,t=e.type,r=e.mapId,n=e.displayName,i=e.nextActivityId,c=e.dispatchOpenActivity,s=e.dispatchHideCompletionModal;if(!t)return Object(a.jsx)("div",{});var o="activity"===t?"Activity Complete!":"Path Complete!",l="Good work! You've completed {0}. Keep going!".split("{0}"),d=[];return"activity"===t&&r&&i?d.push({label:"NEXT",onClick:function(){s(),c(r,i)}}):d.push({label:"CERTIFICATE",onClick:function(){}}),Object(a.jsxs)(B,{title:o,actions:d,onClose:function(){return s()},children:[l[0],Object(a.jsx)("strong",{children:n}),l[1]]})}}]),r}(n.Component);var q={dispatchOpenActivity:L,dispatchHideCompletionModal:function(){return{type:g}}},V=Object(o.b)((function(e,t){if(!e)return{};var r,a,n,i=e.modal||{},c=i.currentMapId,s=i.currentActivityId;if(c){var o=e.maps[c];if(s){var l,d=o.activities[s];r="activity",a=d.displayName,n=null===(l=d.next)||void 0===l?void 0:l[0].activityId}else r="map",a=o.displayName}return{type:r,mapId:c,displayName:a,nextActivityId:n}}),q)(U);function K(e){var t=e.label;return Object(a.jsx)("span",{children:t})}function G(e){var t=e.item,r=e.itemTemplate,n=e.selected,i=e.className,c=e.onSelect,s=r||K;return Object(a.jsx)("div",{className:"carousel-item ".concat(n?"selected":""," ").concat(i||""),onClick:function(){c&&c(t.id)},children:Object(a.jsx)(s,Object(u.a)({},t))})}r(33);var F=function(e){Object(P.a)(r,e);var t=Object(M.a)(r);function r(e){var a;return Object(E.a)(this,r),(a=t.call(this,e)).carouselRef=void 0,a.handleLeftArrowClick=function(){a.carouselRef.scrollBy({left:-window.innerWidth/2})},a.handleRightArrowClick=function(){a.carouselRef.scrollBy({left:window.innerWidth/2})},a.handleScroll=function(){var e=a.carouselRef.scrollLeft;a.setState({showLeft:0!==e,showRight:e!==a.carouselRef.scrollWidth-a.carouselRef.clientWidth})},a.state={showLeft:!1,showRight:!0},a}return Object(T.a)(r,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleScroll)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleScroll)}},{key:"render",value:function(){var e=this,t=this.props,r=t.title,n=t.items,i=t.selectedItem,c=t.itemTemplate,s=t.itemClassName,o=t.onItemSelect,l=t.prependChildren,d=t.appendChildren,u=this.state,p=u.showLeft,v=u.showRight;return Object(a.jsxs)("div",{className:"carousel",children:[r&&Object(a.jsx)("div",{className:"carousel-title",children:r}),p&&Object(a.jsx)("div",{className:"carousel-arrow left",onClick:this.handleLeftArrowClick,children:Object(a.jsx)("i",{className:"icon chevron left"})}),Object(a.jsx)("div",{className:"carousel-items",children:Object(a.jsxs)("div",{className:"carousel-items-inner",onScroll:this.handleScroll,ref:function(t){return e.carouselRef=t},children:[l,n.map((function(e,t){return Object(a.jsx)(G,{className:s,item:e,itemTemplate:c,selected:i===e.id,onSelect:o},t)})),d]})}),v&&Object(a.jsx)("div",{className:"carousel-arrow right",onClick:this.handleRightArrowClick,children:Object(a.jsx)("i",{className:"icon chevron right"})})]})}}]),r}(n.Component),Q=(r(34),function(e){Object(P.a)(r,e);var t=Object(M.a)(r);function r(){var e;Object(E.a)(this,r);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).handleActionButtonClick=function(){var t=e.props,r=t.status,a=t.mapId,n=t.id,i=t.dispatchOpenActivity;switch(r){case"locked":case"completed":break;case"inprogress":case"notstarted":default:return i(a,n)}},e}return Object(T.a)(r,[{key:"getSkillCardActionText",value:function(){switch(this.props.status){case"locked":return"LOCKED";case"completed":return"VIEW CODE";case"inprogress":return"CONTINUE";case"notstarted":default:return"START"}}},{key:"render",value:function(){var e=this.props,t=e.label,r=e.description,n=e.imageUrl,i=e.tags,c=e.status;return Object(a.jsxs)("div",{className:"skill-card ".concat(c||""),children:[Object(a.jsxs)("div",{className:"skill-card-display",children:["locked"===c&&Object(a.jsx)("div",{className:"skill-card-overlay"}),Object(a.jsx)("div",{className:"skill-card-image",children:n?Object(a.jsx)("img",{src:n,alt:"Preview of activity content"}):Object(a.jsx)("i",{className:"icon game"})}),Object(a.jsxs)("div",{className:"skill-card-label",children:[Object(a.jsxs)("div",{className:"skill-card-title",children:[("locked"===c||"completed"===c)&&Object(a.jsx)("i",{className:"icon ".concat("locked"===c?"lock":"check circle")}),Object(a.jsx)("span",{children:t})]}),Object(a.jsx)("div",{className:"skill-card-tags",children:null===i||void 0===i?void 0:i.map((function(e,t){return Object(a.jsx)("div",{children:e},t)}))})]})]}),Object(a.jsxs)("div",{className:"skill-card-info",children:[Object(a.jsx)("div",{className:"skill-card-title",children:t}),Object(a.jsx)("div",{className:"skill-card-description",children:r}),Object(a.jsx)("div",{className:"spacer"}),Object(a.jsxs)("div",{className:"skill-card-action",children:["completed"===c&&Object(a.jsx)("div",{className:"skill-card-button-icon",children:Object(a.jsx)("i",{className:"xicon redo"})}),Object(a.jsx)("div",{className:"skill-card-button",role:"button",onClick:this.handleActionButtonClick,children:this.getSkillCardActionText()})]})]})]})}}]),r}(n.Component));var $={dispatchOpenActivity:L},z=Object(o.b)((function(e,t){var r,a,n,i,c,s="locked";return e.user&&(null===(r=e.maps)||void 0===r?void 0:r[t.mapId])&&(n=e.user,i=e.maps[t.mapId],c=t.id,i.root.activityId===c||function e(t){if(I(n,i.mapId,t.activityId)){if(t.next.some((function(e){return e.activityId===c})))return!0;var r,a=Object(x.a)(t.next);try{for(a.s();!(r=a.n()).done;)if(e(r.value))return!0}catch(s){a.e(s)}finally{a.f()}}return!1}(i.root))&&(s=I(e.user,t.mapId,t.id)?"completed":(null===(a=w(e.user,t.mapId,t.id))||void 0===a?void 0:a.headerId)?"inprogress":"notstarted"),{status:s}}),$)(Q),Y=function(e){Object(P.a)(r,e);var t=Object(M.a)(r);function r(e){var a;return Object(E.a)(this,r),(a=t.call(this,e)).items=void 0,a.onItemSelect=function(e){a.props.dispatchChangeSelectedItem(e)},a.handleEndCardClick=function(){a.props.dispatchShowCompletionModal(a.props.map.mapId)},a.items=a.getItems(e.map.mapId,e.map.root),a}return Object(T.a)(r,[{key:"getItems",value:function(e,t){for(var r=[],a=t;a;)r.push({id:a.activityId,mapId:e,label:a.displayName,description:a.description,tags:a.tags,url:a.url,imageUrl:a.imageUrl}),a=a.next[0];return r}},{key:"getEndCard",value:function(){return Object(a.jsx)("div",{className:"end-card",children:Object(a.jsx)("div",{className:"end-card-icon",onClick:this.handleEndCardClick,children:Object(a.jsx)("i",{className:"icon trophy"})})},"end")}},{key:"render",value:function(){var e=this.props,t=e.map,r=e.user,n=e.selectedItem,i=function(e,t){return!Object.keys(null===t||void 0===t?void 0:t.activities).some((function(r){var a,n;return!(null===e||void 0===e||null===(a=e.mapProgress[t.mapId])||void 0===a||null===(n=a.activityState[r])||void 0===n?void 0:n.isCompleted)}))}(r,t)?[this.getEndCard()]:[];return Object(a.jsx)(F,{title:t.displayName,items:this.items,itemTemplate:z,itemClassName:"linked",onItemSelect:this.onItemSelect,selectedItem:n,appendChildren:i})}}]),r}(n.Component);var J={dispatchChangeSelectedItem:function(e){return{type:h,id:e}},dispatchShowCompletionModal:function(e,t){return{type:k,mapId:e,activityId:t}}},X=Object(o.b)((function(e,t){var r,a;return e?{user:e.user,selectedItem:e.selectedItem&&(null===(r=t.map)||void 0===r||null===(a=r.activities)||void 0===a?void 0:a[e.selectedItem])?e.selectedItem:void 0}:{}}),J)(Y);function Z(e){for(var t,r,a=function(e){var t,r=e.split("\n"),a=[],n=null,i=null,c=null,s=Object(x.a)(r);try{for(s.s();!(t=s.n()).done;){var o=t.value;if(o.trim()){if(o.startsWith("#")){var l=/^(#+)\s*(.+)$/.exec(o);if(l){u(),n={headerKind:1===l[1].length?"single":2===l[1].length?"double":"triple",header:l[2],attributes:{}},i=null,c=null;continue}}if(n){var d=/^[*-]\s+(?:([^:]+):)?(.*)$/.exec(o);d&&(d[1]?(i&&c&&(n.attributes[i]=c.trim()),i=d[1].toLowerCase(),c=d[2]):i&&(c+=d[2]))}}else c&&(c+="\n")}}catch(p){s.e(p)}finally{s.f()}return u(),a;function u(){n&&(i&&c&&(n.attributes[i]=c.trim()),a.push(n))}}(e),n=[],i=-1,c=0;c<a.length;c++)"single"===a[c].headerKind?t={title:(r=a[c]).attributes.name||r.header,description:r.attributes.description,infoUrl:r.attributes.infoUrl}:"double"===a[c].headerKind&&(i>=0&&n.push(ee(a[i],a.slice(i+1,c))),i=c);return(i>0||0===n.length)&&n.push(ee(a[i],a.slice(i+1,a.length))),{maps:n,metadata:t}}function ee(e,t){var r=function(e){var t={mapId:e.header.toLowerCase(),displayName:e.attributes.name||e.header,description:e.attributes.description,prerequisites:[],activities:{}};if(e.attributes.required){var r,a=e.attributes.required.split(","),n=Object(x.a)(a);try{for(n.s();!(r=n.n()).done;){var i=r.value,c=/^\s*(?:(\d+) +)?(.+)$/.exec(i);c[1]?t.prerequisites.push({type:"tag",tag:c[2].trim(),numberCompleted:parseInt(c[1])}):t.prerequisites.push({type:"activity",mapId:c[2].trim()})}}catch(s){n.e(s)}finally{n.f()}}return t}(e),a=t.map(te);r.root=a[0];var n,i=Object(x.a)(a);try{for(i.s();!(n=i.n()).done;){var c=n.value;r.activities[c.activityId]&&ae("Duplicate activity id '".concat(c.activityId,"' in map '").concat(r.mapId,"'")),r.activities[c.activityId]=c}}catch(f){i.e(f)}finally{i.f()}var s,o=Object(x.a)(a);try{for(o.s();!(s=o.n()).done;){var l,d=s.value,p=Object(x.a)(d.nextIds);try{for(p.s();!(l=p.n()).done;){var v=l.value;r.activities[v]||ae("Unknown activity id '".concat(v,"' in map '").concat(r.mapId,"'")),d.next.push(r.activities[v])}}catch(f){p.e(f)}finally{p.f()}}}catch(f){o.e(f)}finally{o.f()}var h={};!function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a[t.activityId]&&ae("Loop in map '".concat(r.mapId,"' detected"));a[t.activityId]=!0,h[t.activityId]=!0,t.next.length>1&&ae("Branching currently not supported");var n,i=Object(x.a)(t.next);try{for(i.s();!(n=i.n()).done;){var c=n.value;e(c,Object(u.a)({},a))}}catch(f){i.e(f)}finally{i.f()}}(r.root);var m,b=Object(x.a)(a);try{for(b.s();!(m=b.n()).done;){var j=m.value;h[j.activityId]||console.warn("Unreachable activity detected '".concat(j.activityId,"' in map '").concat(r.mapId,"'"))}}catch(f){b.e(f)}finally{b.f()}return r}function te(e){var t={activityId:e.header.toLowerCase(),displayName:e.attributes.name||e.header,description:e.attributes.description,url:e.attributes.url,imageUrl:e.attributes.imageurl,tags:re(e.attributes.tags),next:[],nextIds:re(e.attributes.next)};if(e.attributes.type){var r=e.attributes.type.toLowerCase();switch(r){case"tutorial":t.type=r}}if(e.attributes.editor){var a=e.attributes.editor.toLowerCase();switch(a){case"py":case"blocks":case"js":t.editor=a;break;default:t.editor="blocks"}}return t.url||ae("Activity '".concat(t.activityId,"' is missing attribute 'url'")),t.type||ae("Activity '".concat(t.activityId,"' is missing attribute 'type'")),t}function re(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return[];var r=e.split(",").map((function(e){return e.trim().toLowerCase()})).filter((function(e){return!!e}));if(!t){var a={};return r.forEach((function(e){return a[e]=e})),Object.keys(a)}return r}function ae(e){throw e}var ne=r(9),ie=r.n(ne),ce=r(11),se="https://www.makecode.com/api/md";function oe(){var e={cmd:"",arg:""},t=/^#(\w+)(:([:./\-+=\w]+))?/.exec(window.location.hash||"#github:shakao-test/skill-map-test/main/test");return t&&(e={cmd:t[1],arg:t[3]||""}),e}function le(){return(le=Object(ce.a)(ie.a.mark((function e(t,r){var a,n,i;return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&r){e.next=2;break}return e.abrupt("return","");case 2:e.t0=t,e.next="docs"===e.t0?5:"github"===e.t0?10:16;break;case 5:return r=r.trim().replace(/^[\\/]/i,"").replace(/\.md$/i,""),a=window.pxtTargetBundle.name,e.next=9,de("".concat(se,"/").concat(a,"/").concat(r));case 9:return e.abrupt("return",e.sent);case 10:return n=r.trim(),(i=/^(?:(?:https?:\/\/)?[^/]*?github\.com)?(?:\/)?([^/.]+)\/([^/]+)\/(?:blob\/)?([^/]+)\/([^/.]+?)(?:\.md)?$/gi.exec(n))&&(n="https://raw.githubusercontent.com/".concat(i[1],"/").concat(i[2],"/").concat(i[3],"/").concat(i[4],".md")),e.next=15,de(n);case 15:return e.abrupt("return",e.sent);case 16:return e.next=18,de(r);case 18:return e.abrupt("return",e.sent);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function de(e){return new Promise((function(t,r){var a=new XMLHttpRequest;a.addEventListener("error",(function(e){r(e)})),a.addEventListener("load",(function(){try{t(a.responseText)}catch(e){r(e)}})),a.open("GET",e),a.send()}))}r(36);var ue,pe,ve=function(){function e(t,r,a,n){Object(E.a)(this,e),this.name=t,this.version=r,this.upgradeHandler=a,this.quotaExceededHandler=n,this._db=void 0}return Object(T.a)(e,[{key:"throwIfNotOpened",value:function(){if(!this._db)throw new Error("Database not opened; call IDBWrapper.openAsync() first")}},{key:"errorHandler",value:function(e,t,r){console.error(new Error("".concat(this.name," IDBWrapper error for ").concat(t,": ").concat(e.message))),r(e),"QuotaExceededError"===e.name&&(pxt.log("storage quota exceeded..."),pxt.tickEvent("storage.quotaexceedederror"),this.quotaExceededHandler&&this.quotaExceededHandler())}},{key:"getObjectStore",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"readonly";this.throwIfNotOpened();var r=this._db.transaction([e],t);return r.objectStore(e)}},{key:"openAsync",value:function(){var e=this;return new Promise((function(t,r){var a=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(e.name,e.version);a.onsuccess=function(){e._db=a.result,t()},a.onerror=function(){return e.errorHandler(a.error,"open",r)},a.onupgradeneeded=function(t){return e.upgradeHandler&&e.upgradeHandler(t,a)}}))}},{key:"getAsync",value:function(e,t){var r=this;return new Promise((function(a,n){var i=r.getObjectStore(e).get(t);i.onsuccess=function(){return a(i.result)},i.onerror=function(){return r.errorHandler(i.error,"get",n)}}))}},{key:"getAllAsync",value:function(e){var t=this;return new Promise((function(r,a){var n=t.getObjectStore(e).openCursor(),i=[];n.onsuccess=function(){n.result?(i.push(n.result.value),n.result.continue()):r(i)},n.onerror=function(){return t.errorHandler(n.error,"getAll",a)}}))}},{key:"setAsync",value:function(e,t){var r=this;return new Promise((function(a,n){var i,c=r.getObjectStore(e,"readwrite");(i="undefined"!==typeof t.id&&null!==t.id?c.put(t):c.add(t)).onsuccess=function(){return a()},i.onerror=function(){return r.errorHandler(i.error,"set",n)}}))}},{key:"deleteAsync",value:function(e,t){var r=this;return new Promise((function(a,n){var i=r.getObjectStore(e,"readwrite").delete(t);i.onsuccess=function(){return a()},i.onerror=function(){return r.errorHandler(i.error,"delete",n)}}))}},{key:"deleteAllAsync",value:function(e){var t=this;return new Promise((function(r,a){var n=t.getObjectStore(e,"readwrite").clear();n.onsuccess=function(){return r()},n.onerror=function(){return t.errorHandler(n.error,"deleteAll",a)}}))}}],[{key:"deleteDatabaseAsync",value:function(e){return new Promise((function(t,r){var a=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).deleteDatabase(e);a.onsuccess=function(){return t()},a.onerror=function(){return r(a.error)}}))}}]),e}();function he(){return pe||(ue=new me,pe=ue.initAsync().then((function(e){return ue}))),pe}var me=function(){function e(){Object(E.a)(this,e),this.db=void 0,this.db=new ve(e.databaseName,e.version,(function(t,r){var a=r.result;a.createObjectStore(e.projectTable,{keyPath:e.projectKey}),a.createObjectStore(e.userTable,{keyPath:e.userKey})}))}return Object(T.a)(e,[{key:"initAsync",value:function(){return this.db.openAsync()}},{key:"getProjectAsync",value:function(t){return this.db.getAsync(e.projectTable,t).then((function(e){return e.project}))}},{key:"saveProjectAsync",value:function(t){return this.db.setAsync(e.projectTable,{id:t.header.id,project:t})}},{key:"getUserStateAsync",value:function(){return this.db.getAsync(e.userTable,"local-user").then((function(e){return e.user}))}},{key:"saveUserStateAsync",value:function(t){return this.db.setAsync(e.userTable,{id:"local-user",user:t})}}]),e}();me.version=6,me.databaseName="local-skill-map",me.projectTable="projects",me.projectKey="id",me.userTable="users",me.userKey="id";r(37);var be="localhost"===window.location.hostname?"http://localhost:3232/index.html":window.pxtTargetBundle.appTheme.embedUrl,je=function(e){Object(P.a)(r,e);var t=Object(M.a)(r);function r(e){var a;return Object(E.a)(this,r),(a=t.call(this,e)).ref=void 0,a.messageQueue=[],a.handleFrameRef=function(e){e&&e.contentWindow&&(window.addEventListener("message",a.onMessageReceived),a.ref=e)},a.onMessageReceived=function(e){var t=e.data;if("ready"!==t.type)switch(t.action){case"event":a.handleEditorTickEvent(t);break;case"workspacesync":a.handleWorkspaceSyncRequest(t);break;case"workspacesave":a.handleWorkspaceSaveRequestAsync(t);break;default:console.log(JSON.stringify(t,null,4))}else a.handleWorkspaceReadyEventAsync()},a.state={loaded:!1},a}return Object(T.a)(r,[{key:"render",value:function(){var e=this.props,t=e.url,r=e.title,n=this.state.loaded;return Object(a.jsxs)("div",{className:"makecode-frame-outer",children:[Object(a.jsxs)("div",{className:"makecode-frame-loader ".concat(n?"hidden":""),children:[Object(a.jsx)("img",{src:"./logo.svg",alt:"MakeCode Logo"}),Object(a.jsx)("div",{className:"makecode-frame-loader-text",children:"Loading..."})]}),Object(a.jsx)("iframe",{className:"makecode-frame",src:t,title:r,ref:this.handleFrameRef})]})}},{key:"sendMessage",value:function(e){if(this.ref)if(this.ref.contentWindow){for(;this.messageQueue.length;)this.ref.contentWindow.postMessage(this.messageQueue.shift(),"*");this.ref.contentWindow.postMessage(e,"*")}else this.messageQueue.push(e)}},{key:"handleWorkspaceSyncRequest",value:function(e){this.sendMessage(Object(u.a)(Object(u.a)({},e),{},{success:!0,projects:[]}))}},{key:"handleWorkspaceSaveRequestAsync",value:function(){var e=Object(ce.a)(ie.a.mark((function e(t){var r,a,n,i,c;return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props,a=r.dispatchSetHeaderIdForActivity,n=r.activityHeaderId,e.next=3,he();case 3:return i=e.sent,c=Object(u.a)(Object(u.a)({},t.project),{},{header:Object(u.a)(Object(u.a)({},t.project.header),{},{id:n||t.project.header.id})}),e.next=7,i.saveProjectAsync(c);case 7:n||a(c.header.id);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleWorkspaceReadyEventAsync",value:function(){var e=Object(ce.a)(ie.a.mark((function e(){var t,r;return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.activityHeaderId){e.next=10;break}return e.next=3,he();case 3:return t=e.sent,e.next=6,t.getProjectAsync(this.props.activityHeaderId);case 6:r=e.sent,this.sendMessage({type:"pxteditor",action:"importproject",project:r}),e.next=11;break;case 10:this.sendMessage({type:"pxteditor",action:"startactivity",path:this.props.tutorialPath,activityType:"tutorial"});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleEditorTickEvent",value:function(e){switch(e.tick){case"app.editor":this.onEditorLoaded()}}},{key:"onEditorLoaded",value:function(){this.setState({loaded:!0})}}]),r}(n.Component);var fe={dispatchSetHeaderIdForActivity:function(e){return{type:m,id:e}}},Oe=Object(o.b)((function(e,t){if(!e||!e.editorView)return{};var r,a,n=e.editorView,i=n.currentActivityId,c=n.currentMapId,s=n.currentHeaderId,o=e.maps[c].activities[i];return r="".concat(be,"?controller=1&skillsMap=1"),a=o.displayName,{url:r,tutorialPath:o.url,title:a,activityId:i,activityHeaderId:s}}),fe)(je),ye=function(e){Object(P.a)(r,e);var t=Object(M.a)(r);function r(e){var a;return Object(E.a)(this,r),(a=t.call(this,e)).handleHashChange=function(e){var t=oe();a.fetchAndParseSkillMaps(t.cmd,t.arg),e.stopPropagation(),e.preventDefault()},window.addEventListener("hashchange",a.handleHashChange),a}return Object(T.a)(r,[{key:"fetchAndParseSkillMaps",value:function(e,t){var r=this;(function(e,t){return le.apply(this,arguments)})(e,t).then((function(e){if(e)try{var t=Z(e),a=t.maps,n=t.metadata;if((null===a||void 0===a?void 0:a.length)>0&&(r.props.dispatchClearSkillMaps(),a.forEach((function(e){r.props.dispatchAddSkillMap(e)}))),n){var i=n.title,c=n.description,s=n.infoUrl;r.props.dispatchSetPageTitle(i),c&&r.props.dispatchSetPageDescription(c),s&&r.props.dispatchSetPageDescription(s)}}catch(o){console.error("Error parsing markdown")}}))}},{key:"componentDidMount",value:function(){var e=oe();this.fetchAndParseSkillMaps(e.cmd,e.arg)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("hashchange",this.handleHashChange)}},{key:"render",value:function(){var e=this.props,t=e.skillMaps,r=e.activityOpen,n=Object.keys(t).map((function(e){return t[e]}));return Object(a.jsxs)("div",{className:"app-container",children:[Object(a.jsx)(R,{}),r?Object(a.jsx)(Oe,{}):Object(a.jsxs)("div",{children:[Object(a.jsx)(W,{title:"Game Maker Guide",icon:"map",description:"Level up your game making skills by completing the tutorials in this guide."}),Object(a.jsx)("div",{className:"skill-map-container",children:null===n||void 0===n?void 0:n.map((function(e,t){return Object(a.jsx)(X,{map:e},t)}))})]}),Object(a.jsx)(V,{})]})}}]),r}(i.a.Component);var ke={dispatchAddSkillMap:function(e){return{type:p,map:e}},dispatchClearSkillMaps:function(){return{type:v}},dispatchSetPageTitle:function(e){return{type:f,title:e}},dispatchSetPageDescription:function(e){return{type:O,description:e}},dispatchSetPageInfoUrl:function(e){return{type:y,infoUrl:e}}},ge=Object(o.b)((function(e,t){return e?{skillMaps:e.maps,activityOpen:!!e.editorView}:{}}),ke)(ye);r(38);s.a.render(Object(a.jsx)(i.a.StrictMode,{children:Object(a.jsx)(o.a,{store:S,children:Object(a.jsx)(ge,{})})}),document.getElementById("root"))}},[[39,1,2]]]);
//# sourceMappingURL=main.b03cdc22.chunk.js.map