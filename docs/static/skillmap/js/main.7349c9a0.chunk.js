(this.webpackJsonpskillsmap=this.webpackJsonpskillsmap||[]).push([[0],{32:function(e,t,a){},33:function(e,t,a){},34:function(e,t,a){},36:function(e,t,a){},37:function(e,t,a){},38:function(e,t,a){},39:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a(1),i=a.n(n),c=a(12),s=a.n(c),o=a(7),l=a(13),d=a(10),u=a(2),p="ADD_SKILL_MAP",v="CLEAR_SKILL_MAPS",h="CHANGE_SELECTED_ITEM",m="SET_HEADERID_FOR_ACTIVITY",b="OPEN_ACTIVITY",j="CLOSE_ACTIVITY",f="SET_PAGE_TITLE",O="SET_PAGE_DESCRIPTION",y="SET_PAGE_INFO_URL",k="SHOW_COMPLETION_MODAL",g="HIDE_COMPLETION_MODAL",x=a(8);function I(e,t,a){var r;return!!(null===(r=w(e,t,a))||void 0===r?void 0:r.isCompleted)}function w(e,t,a){var r;return null===(r=e.mapProgress[t])||void 0===r?void 0:r.activityState[a]}var C={title:"Game Maker Guide",description:"Level up your game making skills by completing the tutorials in this guide.",user:{mapProgress:{},completedTags:{}},maps:{}};function N(e,t,a,r){var n,i=w(e,t,a);return i||(i={isCompleted:!1,activityId:a,headerId:r}),Object(u.a)(Object(u.a)({},e),{},{mapProgress:Object(u.a)(Object(u.a)({},e.mapProgress),{},Object(d.a)({},t,Object(u.a)(Object(u.a)({},e.mapProgress[t]||{mapId:t}),{},{activityState:Object(u.a)(Object(u.a)({},(null===(n=e.mapProgress[t])||void 0===n?void 0:n.activityState)||{}),{},Object(d.a)({},a,Object(u.a)(Object(u.a)({},i),{},{headerId:r})))})))})}var A=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case p:return Object(u.a)(Object(u.a)({},t),{},{user:Object(u.a)(Object(u.a)({},t.user),{},{mapProgress:Object(u.a)(Object(u.a)({},t.user.mapProgress),{},Object(d.a)({},a.map.mapId,{mapId:a.map.mapId,activityState:{}}))}),maps:Object(u.a)(Object(u.a)({},t.maps),{},Object(d.a)({},a.map.mapId,a.map))});case v:return Object(u.a)(Object(u.a)({},t),{},{maps:{}});case h:return Object(u.a)(Object(u.a)({},t),{},{selectedItem:a.id});case b:return Object(u.a)(Object(u.a)({},t),{},{editorView:{currentMapId:a.mapId,currentActivityId:a.activityId,currentHeaderId:null===(e=w(t.user,a.mapId,a.activityId))||void 0===e?void 0:e.headerId}});case j:return Object(u.a)(Object(u.a)({},t),{},{editorView:void 0});case m:return Object(u.a)(Object(u.a)({},t),{},{editorView:Object(u.a)(Object(u.a)({},t.editorView),{},{currentHeaderId:a.id}),user:N(t.user,t.editorView.currentMapId,t.editorView.currentActivityId,a.id)});case f:return Object(u.a)(Object(u.a)({},t),{},{title:a.title});case O:return Object(u.a)(Object(u.a)({},t),{},{description:a.description});case y:return Object(u.a)(Object(u.a)({},t),{},{infoUrl:a.infoUrl});case k:return Object(u.a)(Object(u.a)({},t),{},{modal:{currentMapId:a.mapId,currentActivityId:a.activityId}});case g:return Object(u.a)(Object(u.a)({},t),{},{modal:void 0});default:return t}},S=Object(l.b)(A),E=a(3),P=a(4),T=a(6),M=a(5),L=function(e,t){return{type:b,mapId:e,activityId:t}},D=function(e){Object(T.a)(a,e);var t=Object(M.a)(a);function a(){var e;Object(E.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).onBackClicked=function(){e.props.dispatchCloseActivity()},e}return Object(P.a)(a,[{key:"render",value:function(){var e=this.props.activityOpen;return Object(r.jsxs)("div",{className:"header",children:[Object(r.jsxs)("div",{className:"header-left",children:[Object(r.jsx)("i",{className:"icon game"}),e&&Object(r.jsx)("i",{className:"icon arrow left",role:"button",onClick:this.onBackClicked})]}),Object(r.jsx)("div",{className:"spacer"}),Object(r.jsxs)("div",{className:"header-right",children:[Object(r.jsx)("i",{className:"icon square"}),"MICROSOFT"]})]})}}]),a}(n.Component);var H={dispatchCloseActivity:function(){return{type:j}}},R=Object(o.b)((function(e,t){return e?{activityOpen:!!e.editorView}:{}}),H)(D),_=function(e){Object(T.a)(a,e);var t=Object(M.a)(a);function a(){return Object(E.a)(this,a),t.apply(this,arguments)}return Object(P.a)(a,[{key:"render",value:function(){var e=this.props,t=e.title,a=e.description,n=e.icon;return Object(r.jsx)("div",{className:"banner",children:Object(r.jsxs)("div",{className:"banner-card",children:[Object(r.jsx)("i",{className:"icon ".concat(n)}),Object(r.jsxs)("div",{className:"banner-text",children:[Object(r.jsx)("div",{className:"banner-title",children:t}),Object(r.jsx)("div",{className:"banner-description",children:a})]})]})})}}]),a}(n.Component);var W=Object(o.b)((function(e,t){return{title:e.title,description:e.description}}))(_),U=(a(32),function(e){Object(T.a)(a,e);var t=Object(M.a)(a);function a(){var e;Object(E.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).handleModalClick=function(e){e.stopPropagation(),e.preventDefault()},e.handleCloseClick=function(){e.props.onClose&&e.props.onClose(),e.setState({visible:!1})},e}return Object(P.a)(a,[{key:"render",value:function(){var e=this.props,t=e.title,a=e.actions;return Object(r.jsx)("div",{className:"modal-overlay",onClick:this.handleCloseClick,children:Object(r.jsxs)("div",{className:"modal",onClick:this.handleModalClick,children:[Object(r.jsxs)("div",{className:"modal-header",children:[Object(r.jsx)("div",{className:"modal-title",children:t}),Object(r.jsx)("div",{className:"spacer"}),Object(r.jsx)("div",{className:"modal-close-icon",onClick:this.handleCloseClick,children:Object(r.jsx)("i",{className:"icon close"})})]}),Object(r.jsx)("div",{className:"modal-body",children:this.props.children}),a&&a.length>0&&Object(r.jsx)("div",{className:"modal-actions",children:a.map((function(e,t){return Object(r.jsx)("div",{className:"modal-button ".concat(e.className),onClick:e.onClick,children:e.label},t)}))})]})})}}]),a}(n.Component)),B=function(e){Object(T.a)(a,e);var t=Object(M.a)(a);function a(){return Object(E.a)(this,a),t.apply(this,arguments)}return Object(P.a)(a,[{key:"render",value:function(){var e=this.props,t=e.type,a=e.mapId,n=e.displayName,i=e.nextActivityId,c=e.dispatchOpenActivity,s=e.dispatchHideCompletionModal;if(!t)return Object(r.jsx)("div",{});var o="activity"===t?"Activity Complete!":"Path Complete!",l="Good work! You've completed {0}. Keep going!".split("{0}"),d=[];return"activity"===t&&a&&i?d.push({label:"NEXT",onClick:function(){s(),c(a,i)}}):d.push({label:"CERTIFICATE",onClick:function(){}}),Object(r.jsxs)(U,{title:o,actions:d,onClose:function(){return s()},children:[l[0],Object(r.jsx)("strong",{children:n}),l[1]]})}}]),a}(n.Component);var q={dispatchOpenActivity:L,dispatchHideCompletionModal:function(){return{type:g}}},V=Object(o.b)((function(e,t){if(!e)return{};var a,r,n,i=e.modal||{},c=i.currentMapId,s=i.currentActivityId;if(c){var o=e.maps[c];if(s){var l,d=o.activities[s];a="activity",r=d.displayName,n=null===(l=d.next)||void 0===l?void 0:l[0].activityId}else a="map",r=o.displayName}return{type:a,mapId:c,displayName:r,nextActivityId:n}}),q)(B);function K(e){var t=e.label;return Object(r.jsx)("span",{children:t})}function G(e){var t=e.item,a=e.itemTemplate,n=e.selected,i=e.className,c=e.onSelect,s=a||K;return Object(r.jsx)("div",{className:"carousel-item ".concat(n?"selected":""," ").concat(i||""),onClick:function(){c&&c(t.id)},children:Object(r.jsx)(s,Object(u.a)({},t))})}a(33);var F=function(e){Object(T.a)(a,e);var t=Object(M.a)(a);function a(e){var r;return Object(E.a)(this,a),(r=t.call(this,e)).carouselRef=void 0,r.handleLeftArrowClick=function(){r.carouselRef.scrollBy({left:-window.innerWidth/2})},r.handleRightArrowClick=function(){r.carouselRef.scrollBy({left:window.innerWidth/2})},r.handleScroll=function(){var e=r.carouselRef.scrollLeft;r.setState({showLeft:0!==e,showRight:e!==r.carouselRef.scrollWidth-r.carouselRef.clientWidth})},r.state={showLeft:!1,showRight:!0},r}return Object(P.a)(a,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleScroll)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleScroll)}},{key:"render",value:function(){var e=this,t=this.props,a=t.title,n=t.items,i=t.selectedItem,c=t.itemTemplate,s=t.itemClassName,o=t.onItemSelect,l=t.prependChildren,d=t.appendChildren,u=this.state,p=u.showLeft,v=u.showRight;return Object(r.jsxs)("div",{className:"carousel",children:[a&&Object(r.jsx)("div",{className:"carousel-title",children:a}),p&&Object(r.jsx)("div",{className:"carousel-arrow left",onClick:this.handleLeftArrowClick,children:Object(r.jsx)("i",{className:"icon chevron left"})}),Object(r.jsx)("div",{className:"carousel-items",children:Object(r.jsxs)("div",{className:"carousel-items-inner",onScroll:this.handleScroll,ref:function(t){return e.carouselRef=t},children:[l,n.map((function(e,t){return Object(r.jsx)(G,{className:s,item:e,itemTemplate:c,selected:i===e.id,onSelect:o},t)})),d]})}),v&&Object(r.jsx)("div",{className:"carousel-arrow right",onClick:this.handleRightArrowClick,children:Object(r.jsx)("i",{className:"icon chevron right"})})]})}}]),a}(n.Component),Q=(a(34),function(e){Object(T.a)(a,e);var t=Object(M.a)(a);function a(){var e;Object(E.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).handleActionButtonClick=function(){var t=e.props,a=t.status,r=t.mapId,n=t.id,i=t.dispatchOpenActivity;switch(a){case"locked":case"completed":break;case"inprogress":case"notstarted":default:return i(r,n)}},e}return Object(P.a)(a,[{key:"getSkillCardActionText",value:function(){switch(this.props.status){case"locked":return"LOCKED";case"completed":return"VIEW CODE";case"inprogress":return"CONTINUE";case"notstarted":default:return"START"}}},{key:"render",value:function(){var e=this.props,t=e.label,a=e.description,n=e.imageUrl,i=e.tags,c=e.status;return Object(r.jsxs)("div",{className:"skill-card ".concat(c||""),children:[Object(r.jsxs)("div",{className:"skill-card-display",children:["locked"===c&&Object(r.jsx)("div",{className:"skill-card-overlay"}),Object(r.jsx)("div",{className:"skill-card-image",children:n?Object(r.jsx)("img",{src:n,alt:"Preview of activity content"}):Object(r.jsx)("i",{className:"icon game"})}),Object(r.jsxs)("div",{className:"skill-card-label",children:[Object(r.jsxs)("div",{className:"skill-card-title",children:[("locked"===c||"completed"===c)&&Object(r.jsx)("i",{className:"icon ".concat("locked"===c?"lock":"check circle")}),Object(r.jsx)("span",{children:t})]}),Object(r.jsx)("div",{className:"skill-card-tags",children:null===i||void 0===i?void 0:i.map((function(e,t){return Object(r.jsx)("div",{children:e},t)}))})]})]}),Object(r.jsxs)("div",{className:"skill-card-info",children:[Object(r.jsx)("div",{className:"skill-card-title",children:t}),Object(r.jsx)("div",{className:"skill-card-description",children:a}),Object(r.jsx)("div",{className:"spacer"}),Object(r.jsxs)("div",{className:"skill-card-action",children:["completed"===c&&Object(r.jsx)("div",{className:"skill-card-button-icon",children:Object(r.jsx)("i",{className:"xicon redo"})}),Object(r.jsx)("div",{className:"skill-card-button",role:"button",onClick:this.handleActionButtonClick,children:this.getSkillCardActionText()})]})]})]})}}]),a}(n.Component));var z={dispatchOpenActivity:L},Y=Object(o.b)((function(e,t){var a,r,n,i,c,s="locked";return e.user&&(null===(a=e.maps)||void 0===a?void 0:a[t.mapId])&&(n=e.user,i=e.maps[t.mapId],c=t.id,i.root.activityId===c||function e(t){if(I(n,i.mapId,t.activityId)){if(t.next.some((function(e){return e.activityId===c})))return!0;var a,r=Object(x.a)(t.next);try{for(r.s();!(a=r.n()).done;)if(e(a.value))return!0}catch(s){r.e(s)}finally{r.f()}}return!1}(i.root))&&(s=I(e.user,t.mapId,t.id)?"completed":(null===(r=w(e.user,t.mapId,t.id))||void 0===r?void 0:r.headerId)?"inprogress":"notstarted"),{status:s}}),z)(Q),$=function(e){Object(T.a)(a,e);var t=Object(M.a)(a);function a(e){var r;return Object(E.a)(this,a),(r=t.call(this,e)).items=void 0,r.onItemSelect=function(e){r.props.dispatchChangeSelectedItem(e)},r.handleEndCardClick=function(){r.props.dispatchShowCompletionModal(r.props.map.mapId)},r.items=r.getItems(e.map.mapId,e.map.root),r}return Object(P.a)(a,[{key:"getItems",value:function(e,t){for(var a=[],r=t;r;)a.push({id:r.activityId,mapId:e,label:r.displayName,description:r.description,tags:r.tags,url:r.url,imageUrl:r.imageUrl}),r=r.next[0];return a}},{key:"getEndCard",value:function(){return Object(r.jsx)("div",{className:"end-card",children:Object(r.jsx)("div",{className:"end-card-icon",onClick:this.handleEndCardClick,children:Object(r.jsx)("i",{className:"icon trophy"})})},"end")}},{key:"render",value:function(){var e=this.props,t=e.map,a=e.user,n=e.selectedItem,i=function(e,t){return!Object.keys(null===t||void 0===t?void 0:t.activities).some((function(a){var r,n;return!(null===e||void 0===e||null===(r=e.mapProgress[t.mapId])||void 0===r||null===(n=r.activityState[a])||void 0===n?void 0:n.isCompleted)}))}(a,t)?[this.getEndCard()]:[];return Object(r.jsx)(F,{title:t.displayName,items:this.items,itemTemplate:Y,itemClassName:"linked",onItemSelect:this.onItemSelect,selectedItem:n,appendChildren:i})}}]),a}(n.Component);var J={dispatchChangeSelectedItem:function(e){return{type:h,id:e}},dispatchShowCompletionModal:function(e,t){return{type:k,mapId:e,activityId:t}}},X=Object(o.b)((function(e,t){var a,r;return e?{user:e.user,selectedItem:e.selectedItem&&(null===(a=t.map)||void 0===a||null===(r=a.activities)||void 0===r?void 0:r[e.selectedItem])?e.selectedItem:void 0}:{}}),J)($);function Z(e){for(var t,a,r=function(e){var t,a=e.split("\n"),r=[],n=null,i=null,c=null,s=Object(x.a)(a);try{for(s.s();!(t=s.n()).done;){var o=t.value;if(o.trim()){if(o.startsWith("#")){var l=/^(#+)\s*(.+)$/.exec(o);if(l){u(),n={headerKind:1===l[1].length?"single":2===l[1].length?"double":"triple",header:l[2],attributes:{}},i=null,c=null;continue}}if(n){var d=/^[*-]\s+(?:([^:]+):)?(.*)$/.exec(o);d&&(d[1]?(i&&c&&(n.attributes[i]=c.trim()),i=d[1].toLowerCase(),c=d[2]):i&&(c+=d[2]))}}else c&&(c+="\n")}}catch(p){s.e(p)}finally{s.f()}return u(),r;function u(){n&&(i&&c&&(n.attributes[i]=c.trim()),r.push(n))}}(e),n=[],i=-1,c=0;c<r.length;c++)"single"===r[c].headerKind?t={title:(a=r[c]).attributes.name||a.header,description:a.attributes.description,infoUrl:a.attributes.infoUrl}:"double"===r[c].headerKind&&(i>=0&&n.push(ee(r[i],r.slice(i+1,c))),i=c);return(i>0||0===n.length)&&n.push(ee(r[i],r.slice(i+1,r.length))),{maps:n,metadata:t}}function ee(e,t){var a=function(e){var t={mapId:e.header.toLowerCase(),displayName:e.attributes.name||e.header,description:e.attributes.description,prerequisites:[],activities:{}};if(e.attributes.required){var a,r=e.attributes.required.split(","),n=Object(x.a)(r);try{for(n.s();!(a=n.n()).done;){var i=a.value,c=/^\s*(?:(\d+) +)?(.+)$/.exec(i);c[1]?t.prerequisites.push({type:"tag",tag:c[2].trim(),numberCompleted:parseInt(c[1])}):t.prerequisites.push({type:"activity",mapId:c[2].trim()})}}catch(s){n.e(s)}finally{n.f()}}return t}(e),r=t.map(te);a.root=r[0];var n,i=Object(x.a)(r);try{for(i.s();!(n=i.n()).done;){var c=n.value;a.activities[c.activityId]&&re("Duplicate activity id '".concat(c.activityId,"' in map '").concat(a.mapId,"'")),a.activities[c.activityId]=c}}catch(f){i.e(f)}finally{i.f()}var s,o=Object(x.a)(r);try{for(o.s();!(s=o.n()).done;){var l,d=s.value,p=Object(x.a)(d.nextIds);try{for(p.s();!(l=p.n()).done;){var v=l.value;a.activities[v]||re("Unknown activity id '".concat(v,"' in map '").concat(a.mapId,"'")),d.next.push(a.activities[v])}}catch(f){p.e(f)}finally{p.f()}}}catch(f){o.e(f)}finally{o.f()}var h={};!function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r[t.activityId]&&re("Loop in map '".concat(a.mapId,"' detected"));r[t.activityId]=!0,h[t.activityId]=!0,t.next.length>1&&re("Branching currently not supported");var n,i=Object(x.a)(t.next);try{for(i.s();!(n=i.n()).done;){var c=n.value;e(c,Object(u.a)({},r))}}catch(f){i.e(f)}finally{i.f()}}(a.root);var m,b=Object(x.a)(r);try{for(b.s();!(m=b.n()).done;){var j=m.value;h[j.activityId]||console.warn("Unreachable activity detected '".concat(j.activityId,"' in map '").concat(a.mapId,"'"))}}catch(f){b.e(f)}finally{b.f()}return a}function te(e){var t={activityId:e.header.toLowerCase(),displayName:e.attributes.name||e.header,description:e.attributes.description,url:e.attributes.url,imageUrl:e.attributes.imageurl,tags:ae(e.attributes.tags),next:[],nextIds:ae(e.attributes.next)};if(e.attributes.type){var a=e.attributes.type.toLowerCase();switch(a){case"tutorial":t.type=a}}if(e.attributes.editor){var r=e.attributes.editor.toLowerCase();switch(r){case"py":case"blocks":case"js":t.editor=r;break;default:t.editor="blocks"}}return t.url||re("Activity '".concat(t.activityId,"' is missing attribute 'url'")),t.type||re("Activity '".concat(t.activityId,"' is missing attribute 'type'")),t}function ae(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return[];var a=e.split(",").map((function(e){return e.trim().toLowerCase()})).filter((function(e){return!!e}));if(!t){var r={};return a.forEach((function(e){return r[e]=e})),Object.keys(r)}return a}function re(e){throw e}var ne=a(9),ie=a.n(ne),ce=a(11),se="https://www.makecode.com/api/md/arcade/";function oe(){var e={cmd:"",arg:""},t=/^#(\w+)(:([:./\-+=\w]+))?/.exec(window.location.hash||"#github:shakao-test/skill-map-test/main/test");return t&&(e={cmd:t[1],arg:t[3]||""}),e}function le(){return(le=Object(ce.a)(ie.a.mark((function e(t,a){var r,n;return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&a){e.next=2;break}return e.abrupt("return","");case 2:e.t0=t,e.next="docs"===e.t0?5:"github"===e.t0?9:15;break;case 5:return a=a.trim().replace(/^\\/i,""),e.next=8,de("".concat(se,"/").concat(a));case 8:return e.abrupt("return",e.sent);case 9:return r=a.trim(),(n=/^(?:(?:https?:\/\/)?[^/]*?github\.com)?(?:\/)?([^/.]+)\/([^/]+)\/(?:blob\/)?([^/]+)\/([^/.]+?)(?:\.md)?$/gi.exec(r))&&(r="https://raw.githubusercontent.com/".concat(n[1],"/").concat(n[2],"/").concat(n[3],"/").concat(n[4],".md")),e.next=14,de(r);case 14:return e.abrupt("return",e.sent);case 15:return e.next=17,de(a);case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function de(e){return new Promise((function(t,a){var r=new XMLHttpRequest;r.addEventListener("error",(function(e){a(e)})),r.addEventListener("load",(function(){try{t(r.responseText)}catch(e){a(e)}})),r.open("GET",e),r.send()}))}a(36);var ue,pe,ve=function(){function e(t,a,r,n){Object(E.a)(this,e),this.name=t,this.version=a,this.upgradeHandler=r,this.quotaExceededHandler=n,this._db=void 0}return Object(P.a)(e,[{key:"throwIfNotOpened",value:function(){if(!this._db)throw new Error("Database not opened; call IDBWrapper.openAsync() first")}},{key:"errorHandler",value:function(e,t,a){console.error(new Error("".concat(this.name," IDBWrapper error for ").concat(t,": ").concat(e.message))),a(e),"QuotaExceededError"===e.name&&(pxt.log("storage quota exceeded..."),pxt.tickEvent("storage.quotaexceedederror"),this.quotaExceededHandler&&this.quotaExceededHandler())}},{key:"getObjectStore",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"readonly";this.throwIfNotOpened();var a=this._db.transaction([e],t);return a.objectStore(e)}},{key:"openAsync",value:function(){var e=this;return new Promise((function(t,a){var r=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(e.name,e.version);r.onsuccess=function(){e._db=r.result,t()},r.onerror=function(){return e.errorHandler(r.error,"open",a)},r.onupgradeneeded=function(t){return e.upgradeHandler&&e.upgradeHandler(t,r)}}))}},{key:"getAsync",value:function(e,t){var a=this;return new Promise((function(r,n){var i=a.getObjectStore(e).get(t);i.onsuccess=function(){return r(i.result)},i.onerror=function(){return a.errorHandler(i.error,"get",n)}}))}},{key:"getAllAsync",value:function(e){var t=this;return new Promise((function(a,r){var n=t.getObjectStore(e).openCursor(),i=[];n.onsuccess=function(){n.result?(i.push(n.result.value),n.result.continue()):a(i)},n.onerror=function(){return t.errorHandler(n.error,"getAll",r)}}))}},{key:"setAsync",value:function(e,t){var a=this;return new Promise((function(r,n){var i,c=a.getObjectStore(e,"readwrite");(i="undefined"!==typeof t.id&&null!==t.id?c.put(t):c.add(t)).onsuccess=function(){return r()},i.onerror=function(){return a.errorHandler(i.error,"set",n)}}))}},{key:"deleteAsync",value:function(e,t){var a=this;return new Promise((function(r,n){var i=a.getObjectStore(e,"readwrite").delete(t);i.onsuccess=function(){return r()},i.onerror=function(){return a.errorHandler(i.error,"delete",n)}}))}},{key:"deleteAllAsync",value:function(e){var t=this;return new Promise((function(a,r){var n=t.getObjectStore(e,"readwrite").clear();n.onsuccess=function(){return a()},n.onerror=function(){return t.errorHandler(n.error,"deleteAll",r)}}))}}],[{key:"deleteDatabaseAsync",value:function(e){return new Promise((function(t,a){var r=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).deleteDatabase(e);r.onsuccess=function(){return t()},r.onerror=function(){return a(r.error)}}))}}]),e}();function he(){return pe||(ue=new me,pe=ue.initAsync().then((function(e){return ue}))),pe}var me=function(){function e(){Object(E.a)(this,e),this.db=void 0,this.db=new ve(e.databaseName,e.version,(function(t,a){var r=a.result;r.createObjectStore(e.projectTable,{keyPath:e.projectKey}),r.createObjectStore(e.userTable,{keyPath:e.userKey})}))}return Object(P.a)(e,[{key:"initAsync",value:function(){return this.db.openAsync()}},{key:"getProjectAsync",value:function(t){return this.db.getAsync(e.projectTable,t).then((function(e){return e.project}))}},{key:"saveProjectAsync",value:function(t){return this.db.setAsync(e.projectTable,{id:t.header.id,project:t})}},{key:"getUserStateAsync",value:function(){return this.db.getAsync(e.userTable,"local-user").then((function(e){return e.user}))}},{key:"saveUserStateAsync",value:function(t){return this.db.setAsync(e.userTable,{id:"local-user",user:t})}}]),e}();me.version=6,me.databaseName="local-skill-map",me.projectTable="projects",me.projectKey="id",me.userTable="users",me.userKey="id";a(37);var be="localhost"===window.location.hostname?"http://localhost:3232/index.html":"https://arcade.makecode.com",je=function(e){Object(T.a)(a,e);var t=Object(M.a)(a);function a(e){var r;return Object(E.a)(this,a),(r=t.call(this,e)).ref=void 0,r.messageQueue=[],r.handleFrameRef=function(e){e&&e.contentWindow&&(window.addEventListener("message",r.onMessageReceived),r.ref=e)},r.onMessageReceived=function(e){var t=e.data;if("ready"!==t.type)switch(t.action){case"event":r.handleEditorTickEvent(t);break;case"workspacesync":r.handleWorkspaceSyncRequest(t);break;case"workspacesave":r.handleWorkspaceSaveRequestAsync(t);break;default:console.log(JSON.stringify(t,null,4))}else r.handleWorkspaceReadyEventAsync()},r.state={loaded:!1},r}return Object(P.a)(a,[{key:"render",value:function(){var e=this.props,t=e.url,a=e.title,n=this.state.loaded;return Object(r.jsxs)("div",{className:"makecode-frame-outer",children:[Object(r.jsxs)("div",{className:"makecode-frame-loader ".concat(n?"hidden":""),children:[Object(r.jsx)("img",{src:"./logo.svg",alt:"MakeCode Logo"}),Object(r.jsx)("div",{className:"makecode-frame-loader-text",children:"Loading..."})]}),Object(r.jsx)("iframe",{className:"makecode-frame",src:t,title:a,ref:this.handleFrameRef})]})}},{key:"sendMessage",value:function(e){if(this.ref)if(this.ref.contentWindow){for(;this.messageQueue.length;)this.ref.contentWindow.postMessage(this.messageQueue.shift(),"*");this.ref.contentWindow.postMessage(e,"*")}else this.messageQueue.push(e)}},{key:"handleWorkspaceSyncRequest",value:function(e){this.sendMessage(Object(u.a)(Object(u.a)({},e),{},{success:!0,projects:[]}))}},{key:"handleWorkspaceSaveRequestAsync",value:function(){var e=Object(ce.a)(ie.a.mark((function e(t){var a,r,n,i,c;return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.props,r=a.dispatchSetHeaderIdForActivity,n=a.activityHeaderId,e.next=3,he();case 3:return i=e.sent,c=Object(u.a)(Object(u.a)({},t.project),{},{header:Object(u.a)(Object(u.a)({},t.project.header),{},{id:n||t.project.header.id})}),e.next=7,i.saveProjectAsync(c);case 7:n||r(c.header.id);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleWorkspaceReadyEventAsync",value:function(){var e=Object(ce.a)(ie.a.mark((function e(){var t,a;return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.activityHeaderId){e.next=10;break}return e.next=3,he();case 3:return t=e.sent,e.next=6,t.getProjectAsync(this.props.activityHeaderId);case 6:a=e.sent,this.sendMessage({type:"pxteditor",action:"importproject",project:a}),e.next=11;break;case 10:this.sendMessage({type:"pxteditor",action:"startactivity",path:this.props.tutorialPath,activityType:"tutorial"});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleEditorTickEvent",value:function(e){switch(e.tick){case"app.editor":this.onEditorLoaded()}}},{key:"onEditorLoaded",value:function(){this.setState({loaded:!0})}}]),a}(n.Component);var fe={dispatchSetHeaderIdForActivity:function(e){return{type:m,id:e}}},Oe=Object(o.b)((function(e,t){if(!e||!e.editorView)return{};var a,r,n=e.editorView,i=n.currentActivityId,c=n.currentMapId,s=n.currentHeaderId,o=e.maps[c].activities[i];return a="".concat(be,"/?controller=1&skillsMap=1"),r=o.displayName,{url:a,tutorialPath:o.url,title:r,activityId:i,activityHeaderId:s}}),fe)(je),ye=function(e){Object(T.a)(a,e);var t=Object(M.a)(a);function a(e){var r;return Object(E.a)(this,a),(r=t.call(this,e)).handleHashChange=function(e){var t=oe();r.fetchAndParseSkillMaps(t.cmd,t.arg),e.stopPropagation(),e.preventDefault()},window.addEventListener("hashchange",r.handleHashChange),r}return Object(P.a)(a,[{key:"fetchAndParseSkillMaps",value:function(e,t){var a=this;(function(e,t){return le.apply(this,arguments)})(e,t).then((function(e){if(e)try{var t=Z(e),r=t.maps,n=t.metadata;if((null===r||void 0===r?void 0:r.length)>0&&(a.props.dispatchClearSkillMaps(),r.forEach((function(e){a.props.dispatchAddSkillMap(e)}))),n){var i=n.title,c=n.description,s=n.infoUrl;a.props.dispatchSetPageTitle(i),c&&a.props.dispatchSetPageDescription(c),s&&a.props.dispatchSetPageDescription(s)}}catch(o){console.error("Error parsing markdown")}}))}},{key:"componentDidMount",value:function(){var e=oe();this.fetchAndParseSkillMaps(e.cmd,e.arg)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("hashchange",this.handleHashChange)}},{key:"render",value:function(){var e=this.props,t=e.skillMaps,a=e.activityOpen,n=Object.keys(t).map((function(e){return t[e]}));return Object(r.jsxs)("div",{className:"app-container",children:[Object(r.jsx)(R,{}),a?Object(r.jsx)(Oe,{}):Object(r.jsxs)("div",{children:[Object(r.jsx)(W,{title:"Game Maker Guide",icon:"map",description:"Level up your game making skills by completing the tutorials in this guide."}),Object(r.jsx)("div",{className:"skill-map-container",children:null===n||void 0===n?void 0:n.map((function(e,t){return Object(r.jsx)(X,{map:e},t)}))})]}),Object(r.jsx)(V,{})]})}}]),a}(i.a.Component);var ke={dispatchAddSkillMap:function(e){return{type:p,map:e}},dispatchClearSkillMaps:function(){return{type:v}},dispatchSetPageTitle:function(e){return{type:f,title:e}},dispatchSetPageDescription:function(e){return{type:O,description:e}},dispatchSetPageInfoUrl:function(e){return{type:y,infoUrl:e}}},ge=Object(o.b)((function(e,t){return e?{skillMaps:e.maps,activityOpen:!!e.editorView}:{}}),ke)(ye);a(38);s.a.render(Object(r.jsx)(i.a.StrictMode,{children:Object(r.jsx)(o.a,{store:S,children:Object(r.jsx)(ge,{})})}),document.getElementById("root"))}},[[39,1,2]]]);
//# sourceMappingURL=main.7349c9a0.chunk.js.map